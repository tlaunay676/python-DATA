#Moyenne espérance de vie, autres variables d'intérêt
import csv
#on met le fichier ou se trouve la variable d'intérêt dans le premier argument, le numéro de colonne (0 si c'est la première) où elle se trouve dans la deuxième
def moyenne(fichier_csv,numero_colonne):
    somme = 0.0
    nombre=0
    with open(fichier_csv, mode='r', encoding='utf-8') as fichier:
        lecteur_csv = csv.reader(fichier)
        next(lecteur_csv)  # Ignorer la première ligne (en-tête)
        for ligne in lecteur_csv:
            try:
                valeur = float(ligne[numero_colonne])  # Index 35 pour la colonne 36
                somme += valeur
                nombre= nombre+1
            except (ValueError, IndexError):
                print(f"Attention : une valeur non numérique ou une ligne incomplète a été ignorée : {ligne}")
    return somme/nombre

#Mediane variables d'intérêt
def mediane(fichier_csv,numero_colonne):
    
# Exemple d'utilisation
fichier = "WHO_SDG3_SELECT_COUNTRY_2025.csv"
resultat = moyenne(fichier,35)
print(f"La somme des valeurs de la colonne 36 (à partir de la ligne 2) est : {resultat}")

#code régression linéaire simple avec Y=a+b*log(X)
import numpy as np
import pandas as pd
import statsmodels.api as sm

# 1. Chargement
df = pd.read_csv('Table_complète.csv')

# --- ETAPE DE NETTOYAGE CRITIQUE ---

# A. On supprime les lignes vides dès le départ (NaN)
# Si une ligne n'a pas de PIB ou pas d'espérance de vie, on l'enlève
df = df.dropna(subset=['2021', 'Espérance de vie totale'])

# B. On ne garde que les PIB strictement positifs
# C'est OBLIGATOIRE pour le logarithme. log(0) = infini (erreur)
df = df[df['2021'] > 0]

# --- FIN DU NETTOYAGE ---

# 2. Création du Log
df['log_PIB'] = np.log(df['2021'])

# 3. Vérification ultime (au cas où des infinis traînent encore)
# On remplace les infinis par NaN et on les supprime
df.replace([np.inf, -np.inf], np.nan, inplace=True)
df = df.dropna(subset=['log_PIB', 'Espérance de vie totale'])

# 4. Définition des variables finales
Y = df['Espérance de vie totale']
X = df['log_PIB']

print(f"Nombre de lignes utilisées pour la régression : {len(df)}")

# 5. Régression
X_with_const = sm.add_constant(X)
modele = sm.OLS(Y, X_with_const)
resultats = modele.fit()

print(resultats.summary())

# --- 5. GRAPHIQUE (Optionnel pour vérifier visuellement) ---
plt.scatter(df['log_PIB'], df['Espérance de vie totale'], alpha=0.5, label='Données')
plt.plot(df['log_PIB'], resultats.predict(), color='red', label='Régression')
plt.xlabel('Log(PIB)')
plt.ylabel('Espérance de vie totale')
plt.legend()
plt.show()